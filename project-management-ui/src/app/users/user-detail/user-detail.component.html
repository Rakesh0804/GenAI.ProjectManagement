<div class="user-detail-container" *ngIf="!isLoading && user">
  <!-- Header Section -->
  <div class="header-section">
    <button mat-icon-button (click)="goBack()" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    
    <div class="user-header">
      <div class="user-avatar">
        {{ getInitials() }}
      </div>
      
      <div class="user-info">
        <h1 class="user-name">{{ getFullName() }}</h1>
        <p class="user-email">{{ user.email }}</p>
        <mat-chip-set>
          <mat-chip [class]="user.isActive ? 'status-active' : 'status-inactive'">
            {{ user.isActive ? 'Active' : 'Inactive' }}
          </mat-chip>
        </mat-chip-set>
      </div>
      
      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="editUser()">
          <mat-icon>edit</mat-icon>
          Edit User
        </button>
      </div>
    </div>
  </div>

  <!-- Content Tabs -->
  <mat-tab-group class="content-tabs">
    <!-- Overview Tab -->
    <mat-tab label="Overview">
      <div class="tab-content">
        <div class="info-grid">
          <!-- Personal Information -->
          <mat-card class="info-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>person</mat-icon>
                Personal Information
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="info-row">
                <span class="label">First Name:</span>
                <span class="value">{{ user.firstName }}</span>
              </div>
              <div class="info-row">
                <span class="label">Last Name:</span>
                <span class="value">{{ user.lastName }}</span>
              </div>
              <div class="info-row">
                <span class="label">Email:</span>
                <span class="value">{{ user.email }}</span>
              </div>
              <div class="info-row">
                <span class="label">Phone:</span>
                <span class="value">{{ user.phoneNumber || 'Not provided' }}</span>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Account Information -->
          <mat-card class="info-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>account_circle</mat-icon>
                Account Information
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="info-row">
                <span class="label">Username:</span>
                <span class="value">{{ user.userName }}</span>
              </div>
              <div class="info-row">
                <span class="label">Status:</span>
                <span class="value">
                  <mat-chip [class]="user.isActive ? 'status-active' : 'status-inactive'">
                    {{ user.isActive ? 'Active' : 'Inactive' }}
                  </mat-chip>
                </span>
              </div>
              <div class="info-row">
                <span class="label">Last Login:</span>
                <span class="value">{{ formatDate(user.lastLoginAt) }}</span>
              </div>
              <div class="info-row">
                <span class="label">Manager:</span>
                <span class="value">{{ user.managerName || 'No manager assigned' }}</span>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- System Information -->
          <mat-card class="info-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>info</mat-icon>
                System Information
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="info-row">
                <span class="label">Created:</span>
                <span class="value">{{ formatDate(user.createdAt) }}</span>
              </div>
              <div class="info-row">
                <span class="label">Last Updated:</span>
                <span class="value">{{ formatDate(user.updatedAt) }}</span>
              </div>
              <div class="info-row">
                <span class="label">User ID:</span>
                <span class="value user-id">{{ user.id }}</span>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Subordinates Tab -->
    <mat-tab label="Team Members" [disabled]="subordinates.length === 0">
      <div class="tab-content">
        <mat-card *ngIf="subordinates.length > 0">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>group</mat-icon>
              Direct Reports ({{ subordinates.length }})
            </mat-card-title>
            <mat-card-subtitle>Users who report to {{ getFullName() }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="subordinates" class="subordinates-table">
              <!-- Name Column -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let subordinate">
                  <div class="user-info">
                    <div class="user-avatar-small">
                      {{ subordinate.firstName.charAt(0) }}{{ subordinate.lastName.charAt(0) }}
                    </div>
                    <div class="user-details">
                      <div class="user-name">{{ subordinate.firstName }} {{ subordinate.lastName }}</div>
                      <div class="user-email">{{ subordinate.email }}</div>
                    </div>
                  </div>
                </td>
              </ng-container>

              <!-- Username Column -->
              <ng-container matColumnDef="userName">
                <th mat-header-cell *matHeaderCellDef>Username</th>
                <td mat-cell *matCellDef="let subordinate">{{ subordinate.userName }}</td>
              </ng-container>

              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let subordinate">
                  <mat-chip [class]="subordinate.isActive ? 'status-active' : 'status-inactive'">
                    {{ subordinate.isActive ? 'Active' : 'Inactive' }}
                  </mat-chip>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="['name', 'userName', 'status']"></tr>
              <tr mat-row *matRowDef="let row; columns: ['name', 'userName', 'status'];"></tr>
            </table>
          </mat-card-content>
        </mat-card>

        <div *ngIf="subordinates.length === 0" class="no-subordinates">
          <mat-icon>group_outline</mat-icon>
          <h3>No Direct Reports</h3>
          <p>{{ getFullName() }} doesn't have any team members reporting to them.</p>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

<div class="loading-container" *ngIf="isLoading">
  <mat-spinner></mat-spinner>
  <p>Loading user details...</p>
</div>
